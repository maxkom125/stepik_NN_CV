# stepik_NN_CV
Некоторые программы из курса Нейронные сети и компьютерное зрение на Stepik от Samsung.

1) Conv2dLoop.py Реализация сверточного слоя через циклы

2) Conv_as_mul.py Реализация сверточного слоя через матричное умножение.

Рассмотрим свертку одного одноканального изображения размером 4*4 пикселя (значения пикселей обозначены через X).
Сворачивать будем с ядром из одного фильтра размером 3*3, веса обозначены через W.
Для простоты примем stride = 1.
Тогда выход Y будет иметь размерность 1*1*2*2 (в данном случае на входе одно изображение - это первая единица в размерности, в ядре один фильтр - это вторая единица в размерности выхода).
![alt text](https://github.com/maxkom125/stepik_NN_CV/images/img1.png)



Если фильтров в ядре больше одного. Заметим, что для каждого фильтра, матрица W’ будет умножаться на один и тот же вектор изображения. Значит, можно сконкатенировать матрицы фильтров ядра по вертикали и за одно умножение получить ответ для всех фильтров.

![alt text](https://github.com/maxkom125/stepik_NN_CV/images/img2.png)


Если на входе более одного изображения: заметим, что матрица W’ одинакова для всех изображений батча, то есть, можно каждое изображение вначале вытянуть в столбец, а затем эти столбцы для всех изображений батча сконкатенировать по горизонтали.

![alt text](https://github.com/maxkom125/stepik_NN_CV/images/img3.png)

Если в изображении больше одного слоя, вначале выполним преобразования входа и ядра для каждого слоя, а затем сконкатенируем: вектора разных слоев входа в один большой вектор, а матрицы ядра соответственно в одну длинную матрицу. И мы получим сложение от выходов по слоям в процессе перемножения матриц. 



То есть даже в самом общем случае мы за одно умножение матриц можем получить ответ.
Но рассчитанный таким способом выход не совпадает по размерности с выходом стандартного слоя из PyTorch - изменим размерность.


3) Conv_as_mul2.py Реализация сверточного слоя через матричное умножение.
![alt text](https://github.com/maxkom125/stepik_NN_CV/images/img4.png)
В предыдущей реализации W’ имеет много нулей. Это снижает эффективность метода.
Далее представлена реализация через матрицы другим, более эффективным способом.
Пусть в этот раз на входе батч из одного трехслойного (RGB) изображения размером 3*3.
Пусть ядро имеет 2 фильтра шириной и высотой 2 пикселя.
Тогда выход должен иметь размерность 1*2*2*2.
Пусть W - веса ядра, X - значения входной матрицы, Y - значения на выходе.
Для простоты слои изображения и слои фильтров ядра покрашены в цвета.

Обратите внимание, например, "синяя" X0 не обязано быть равно "красному" X0, аналогично и про значения в фильтрах ядра - разный цвет и одинаковые переменные могут иметь разные значения, такое обозначение выбрано, чтобы не загромождать рисунок сложными индексами.


![alt text](https://github.com/maxkom125/stepik_NN_CV/images/img5.png)
Если изображений в батче больше одного: преобразования ядра от этого не меняется, а преобразованные матрицы входных изображений конкатенируются по горизонтали.

Но рассчитанный таким способом выход не совпадает по размерности с выходом стандартного слоя из PyTorch — изменяем размерность.


